name: Run xray-checker

on:
  workflow_dispatch: # Ручной запуск
  schedule:
    - cron: "0/5 * * * *" # Запуск каждые 5 минут

jobs:
  run-xray-checker:
    runs-on: ubuntu-latest
    steps:
      - name: Run Xray Checker
        id: checker
        uses: docker://kutovoys/xray-checker
        env:
          SUBSCRIPTION_URL: ${{ secrets.SUBSCRIPTION_URL }}
        continue-on-error: true

      - name: Notify on Failure
        if: steps.checker.outcome == 'failure'
        uses: appleboy/telegram-action@master
        with:
          to: ${{ secrets.TELEGRAM_TO }}
          token: ${{ secrets.TELEGRAM_TOKEN }}
          message: |
            'Xray Checker Failed'
